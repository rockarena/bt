"use strict";!function(){angular.module("nimbusYoutubeLibrary",[])}(),function(){angular.module("nimbusYoutubeLibrary").filter("period",function(){function a(a,b){var c=a+"";if(c.length<b){var d;for(d=0;d<b-c.length;d++)c="0"+c}return c}return function(b){if("string"==typeof b&&(b=parseFloat(b)),isNaN(b))return"--";var c=Math.floor(b/3600),d=b-3600*c,e=Math.floor(d/60);return d-=60*e,a(c,2)+":"+a(e,2)+":"+a(d.toFixed(1),4)}})}(),function(){function a(a,b){function c(a){q.state.value=a.data,g().then(i)}function d(b,d,e){return q._playerPromise||(console.log("Requesting new player instance"),q._playerPromise=a.getPlayer(b,d,e,c)),q._playerPromise}function e(a){var c=b.defer();return q.getPlayer().then(function(b){c.resolve(b[a]())}),c.promise}function f(){return e("getPlaylist")}function g(){var a=b.defer();return q.getPlayer().then(function(b){if(q.state.value>0){var c=b.getDuration(),d=b.getPlaylist(),e=b.getPlaylistIndex(),f=d[e];a.resolve({id:f,title:q.titles[f],description:q.descriptions[f],duration:c})}else a.resolve({id:null,title:"Nothing playing",description:"",duration:0})}),a.promise}function h(a,c,d){if(!a)throw new Error("ids must be provided when adding a playlist entry");if(!c)throw new Error("Titles must be provided when adding a playlist entry");angular.copy({},q.titles),angular.copy({},q.descriptions),angular.copy({},q.titleDescriptions);var e;for(e=0;e<a.length;e++)q.titles[a[e]]=c[e],d?q.descriptions[a[e]]=d[e]:q.descriptions[a[e]]="",q.titleDescriptions[a[e]]={title:c[e],description:q.descriptions[a[e]]};var f=b.defer();return q.getPlayer().then(function(b){b.cuePlaylist({playlist:a}),f.resolve(!0)}),f.promise}function i(a){q.current.id=a.id,q.current.title=a.title,q.current.description=a.description,q.current.duration=a.duration}function j(){e("nextVideo")}function k(){e("previousVideo")}function l(a){var c=b.defer();return q.getPlayer().then(function(b){b.playVideoAt(a),g().then(function(a){i(a),c.resolve()})}),c.promise}function m(){return q.titles}function n(){return q.descriptions}function o(){return q.titleDescriptions}function p(a){var c=b.defer();return q.getPlayer().then(function(b){var d=b.getPlaylist();if(d){var e=a<d.length?d[a]:null;e?c.resolve({id:e,title:q.titles[e],description:q.descriptions[e]}):c.resolve(null)}else c.resolve(null)}),c.promise}var q=this;q.titles={},q.descriptions={},q.titleDescriptions={},q.current={title:"Nothing playing",duration:0,description:"No description",id:null},q.state={value:-1},q.getPlayer=d,q.getPlaylistIDs=f,q.getCurrentlyPlayingInfo=g,q.createPlaylist=h,q.playNext=j,q.playPrev=k,q.playVideo=l,q.getTitles=m,q.getDescriptions=n,q.getInfoFor=p,q.getTitleAndDescriptions=o,q._playerPromise=null}angular.module("nimbusYoutubeLibrary").controller("PlaylistController",["YoutubeService","$q",a])}(),function(){function a(a,b,c,d){var e=c.width,f=c.height,g=c.target;a.$on("youtubeServiceReady",function(){console.log("Attaching player on "+g+" with "+e+"x"+f),d.getPlayer(g,e,f).then(function(){console.log("Player attached")},function(a){console.log("Error getting player:",a)})})}angular.module("nimbusYoutubeLibrary").directive("nimbusYoutubePlayer",function(){return{restrict:"E",scope:!1,transclude:!0,controller:"PlaylistController",controllerAs:"vc",template:'<div class="youtube-player" ng-transclude></div>',link:a}}).directive("nimbusPlaylist",function(){return{restrict:"E",replace:!0,require:"^nimbusYoutubePlayer",scope:{},controller:["$scope",function(a){a.videoIds=[],a.titles=[],a.descriptions=[],this.addEntry=function(b){a.videoIds.push(b.id),a.titles.push(b.title),a.descriptions.push(b.description||""),console.log("Added playlist entry: "+b.id)}}],link:function(a,b,c,d){a.$on("youtubePlayerReady",function(){d.createPlaylist(a.videoIds,a.titles,a.descriptions)})}}}).directive("entry",function(){return{restrict:"E",replace:!0,require:"^nimbusPlaylist",scope:{id:"@",title:"@",description:"@"},link:function(a,b,c,d){d.addEntry(a)}}})}(),function(){function a(a,b,c){function d(){console.log("YT library is ready"),h.ready=!0,a.$broadcast("youtubeServiceReady")}function e(c,d,e,f){function g(b){a.$broadcast("youtubePlayerReady"),j.resolve(b.target)}function i(a){var b;switch(a.data){case 2:b="The request contains an invalid parameter value.";break;case 5:b="The requested content cannot be played in an HTML5 player";break;case 100:case 150:b="The video requested was not found."}j.reject(new Error("Could not create new YouTube player because "+b))}if(console.log(h),!h.ready)return b.reject("YouTube service is not ready. Cannot create player");var j=b.defer(),k={height:e,width:d,events:{onReady:g,onStateChange:f,onError:i}};return new YT.Player(c,k),j.promise}var f=c.document;c.onYouTubeIframeAPIReady=d;var g=f.createElement("script");g.src="https://www.youtube.com/iframe_api",f.body.appendChild(g);var h={ready:!1};return h.getPlayer=e,h}angular.module("nimbusYoutubeLibrary").factory("YoutubeService",["$rootScope","$q","$window",a])}();